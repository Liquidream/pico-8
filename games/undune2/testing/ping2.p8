pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
 printh("....")
 ping2({},8.5,8.5,
  function(unit,x,y)
   --printh(t().." > "..x..","..y)
   mset(x,y,1)   
   cls(15)map(0,0,0,0,32,32)flip()
  end,
 6.1)
end

function _update()
end

function _draw()
 cls(15)
 map(0,0,0,0,32,32)
end

function ping2(unit,x,y,func,max_dist,skip_yield)
 cls(15)flip()
--for d=0,max_dist do
d=max_dist
 for r=0,flr(d*sqrt(.5)) do
  d=flr(sqrt(d*d-r*r))+0.25
  printh("d="..d.." r="..r)
  map()flip()
  mset(x-d,y+r,1)  
  map()flip()
  mset(x+d,y+r,1)
  map()flip()
  mset(x-d,y-r,1)
  map()flip()
  mset(x+d,y-r,1)
  map()flip()
  mset(x+r,y-d,1)
  map()flip()
  mset(x+r,y+d,1)
  map()flip()
  mset(x-r,y-d,1)
  map()flip()
  mset(x-r,y+d,1)
  map()flip()
--  if(r==1)stop()
 end
--end
end

function ping(unit,x,y,func,max_dist,skip_yield)
 for t=0,max_dist or 1,.04 do
 	local xx,yy=mid(flr(x+t*cos(t)),61),mid(flr(y+t*sin(t)),61)
		if (func(unit,xx,yy)) return xx,yy
  -- give others a chance!  
  --if (not skip_yield) yield()  -- (better perf for unit updates, but causes pauses on start/deploy harvester)  
 end
end
__gfx__
00000000808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
